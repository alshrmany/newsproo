<!-- accounts/templates/accounts/register_modal.html -->
<div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="registerModalLabel"><i class="fas fa-user-plus me-2"></i>إنشاء حساب جديد</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div id="registerMessages"></div>

        <form id="registerForm" method="post" action="{% url 'accounts:register' %}">
          {% csrf_token %}

          <div class="mb-3">
            <label for="register_username" class="form-label"><i class="fas fa-user me-2"></i>اسم المستخدم</label>
            <input type="text" class="form-control" id="register_username" name="username" placeholder="اختر اسم مستخدم فريد" required />
            <div class="invalid-feedback" id="usernameError"></div>
          </div>

          <div class="mb-3">
            <label for="register_email" class="form-label"><i class="fas fa-envelope me-2"></i>البريد الإلكتروني</label>
            <input type="email" class="form-control" id="register_email" name="email" placeholder="example@email.com" required />
            <div class="invalid-feedback" id="emailError"></div>
          </div>

          <div class="mb-3">
            <label for="register_password1" class="form-label"><i class="fas fa-lock me-2"></i>كلمة المرور</label>
            <div class="input-group">
              <input type="password" class="form-control" id="register_password1" name="password1" placeholder="كلمة المرور" required />
              <button type="button" class="btn btn-outline-secondary" onclick="toggleRegisterPassword('register_password1')"><i class="fas fa-eye"></i></button>
            </div>
            <div class="invalid-feedback" id="password1Error"></div>
            <div class="form-text">كلمة المرور يجب أن تحتوي على 8 أحرف على الأقل.</div>
          </div>

          <div class="mb-4">
            <label for="register_password2" class="form-label"><i class="fas fa-lock me-2"></i>تأكيد كلمة المرور</label>
            <div class="input-group">
              <input type="password" class="form-control" id="register_password2" name="password2" placeholder="تأكيد كلمة المرور" required />
              <button type="button" class="btn btn-outline-secondary" onclick="toggleRegisterPassword('register_password2')"><i class="fas fa-eye"></i></button>
            </div>
            <div class="invalid-feedback" id="password2Error"></div>
          </div>

          <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="register_agree_terms" name="agree_terms" required />
            <label class="form-check-label" for="register_agree_terms">أوافق على <a href="#" class="text-primary">شروط الاستخدام</a> و <a href="#" class="text-primary">سياسة الخصوصية</a></label>
          </div>

          <button type="submit" class="btn btn-primary w-100 mb-3"><i class="fas fa-user-plus me-2"></i> إنشاء حساب</button>
        </form>

        <div class="text-center">
          <p class="mb-0">
            لديك حساب بالفعل؟
            <a href="#" class="text-primary fw-bold" onclick="switchToLogin()">سجل الدخول هنا</a>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>// دالة تبديل رؤية كلمة المرور للتسجيل function toggleRegisterPassword(fieldId) { const passwordInput = document.getElementById(fieldId); const eyeIcon = passwordInput.parentElement.querySelector('i');

if (passwordInput.type === 'password') { passwordInput.type = 'text'; eyeIcon.classList.replace('fa-eye', 'fa-eye-slash'); } else { passwordInput.type = 'password'; eyeIcon.classList.replace('fa-eye-slash', 'fa-eye'); } }

// التحقق من تطابق كلمات المرور function checkRegisterPasswordMatch() { const password1 = document.getElementById('register_password1').value; const password2 = document.getElementById('register_password2').value; const password2Input = document.getElementById('register_password2');

if (password2 && password1 !== password2) { password2Input.classList.add('is-invalid'); document.getElementById('password2Error').textContent = 'كلمات المرور غير متطابقة'; } else { password2Input.classList.remove('is-invalid'); document.getElementById('password2Error').textContent = ''; } }

// التبديل إلى نافذة تسجيل الدخول function switchToLogin() { // إغلاق نافذة التسجيل var registerModal = bootstrap.Modal.getInstance(document.getElementById('registerModal')); registerModal.hide();

// فتح نافذة تسجيل الدخول بعد فترة بسيطة setTimeout(function() { var loginModal = new bootstrap.Modal(document.getElementById('loginModal')); loginModal.show(); }, 300); }

// AJAX Register $(document).ready(function() { $('#registerForm').on('submit', function(e) { e.preventDefault();

const form = $(this); const submitBtn = form.find('button[type="submit"]'); const originalText = submitBtn.html();

// التحقق من تطابق كلمات المرور قبل الإرسال const password1 = $('#register_password1').val(); const password2 = $('#register_password2').val();

if (password1 !== password2) { $('#registerMessages').html(`<div class="alert alert-danger alert-dismissible fade show" role="alert">
  <i class="fas fa-exclamation-circle me-2"></i>كلمات المرور غير متطابقة
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>`); return; }

// عرض حالة التحميل submitBtn.html('<i class="fas fa-spinner fa-spin me-2"></i>جاري إنشاء الحساب...'); submitBtn.prop('disabled', true);

$.ajax({ type: 'POST', url: form.attr('action'), data: form.serialize(), headers: { 'X-Requested-With': 'XMLHttpRequest' }, success: function(response) { if (response.success) { $('#registerMessages').html(`<div class="alert alert-success alert-dismissible fade show" role="alert">
  <i class="fas fa-check-circle me-2"></i>${response.message}
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>`);

// إعادة تحميل الصفحة بعد نجاح التسجيل setTimeout(() => { window.location.reload(); }, 1500); } else { // عرض الأخطاء $('.is-invalid').removeClass('is-invalid'); $('.invalid-feedback').text('');

for (const field in response.errors) { const input = $(`[name="${field}"]`); const errorDiv = $(`#${field}Error`);

input.addClass('is-invalid'); if (response.errors[field][0]) { errorDiv.text(response.errors[field][0]); } } } }, error: function(xhr, status, error) { $('#registerMessages').html(`<div class="alert alert-danger alert-dismissible fade show" role="alert">
  <i class="fas fa-exclamation-circle me-2"></i>حدث خطأ أثناء إنشاء الحساب. حاول مرة أخرى.
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>`); console.error('Error:', error); }, complete: function() { submitBtn.html(originalText); submitBtn.prop('disabled', false); } }); });

// إعادة تعيين النموذج عند إغلاق المودال $('#registerModal').on('hidden.bs.modal', function() { $('#registerForm')[0].reset(); $('.is-invalid').removeClass('is-invalid'); $('.invalid-feedback').text(''); $('#registerMessages').empty(); });

// التحقق من تطابق كلمات المرور أثناء الكتابة $('#register_password1, #register_password2').on('input', checkRegisterPasswordMatch); });
